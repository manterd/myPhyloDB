{% extends 'base.html' %}
{% load static %}

{% block pagetitle %}
    <title>PCoA</title>
{% endblock pagetitle %}

{% block user %}
    {% if user.is_authenticated %}
        <p>You are logged in as:<br>&nbsp;{{ user.username }}</p>
    {% endif %}
{% endblock user %}

{% block menu_item %}
    <p><input id="run" type="submit" value="Run Analysis!" style="background-color: lightgray"/></p>
    <br>
    <p><input id="stop" type="submit" value="Stop Analysis!" style="background-color: lightgray"/></p>
{% endblock menu_item %}

{% block javascript %}
    <style>
        .inlineTable {
            display: inline-block;
            vertical-align: top;
        }
    </style>

    <script type="text/javascript">
        var DepVar = 1, NormMeth = 3, selTheme = 0;
        var nodesCat = "", nodesQuant = "", taxaLevel = 7;
        var chart1 = {}, chart2 = {}, display = 1;
        var catOptions = {};
        var distance = 15, PC1 = 1, PC2 = 2, test = 1;
        var remove = 0;
        var refresh = 0;
        var running = false;

        $(function () {

            $(window).bind('beforeunload', function(){
                $.ajax({
                    url: '/removegraphPCoA/',
                    async: false
                });
            });

            $("#tree_metaCat").dynatree({
                checkbox: true,
                selectMode: 3,
                initAjax: {
                    url: '/getSampleCatTree/',
                    dataType: 'jsonp',
                    data: {}
                },
                onLazyRead: function(node) {
                    node.appendAjax({
                        url: '/getSampleCatTreeChildren/',
                        data: {pType: node.data.pType, field: node.data.title},
                        success: function(node) {
                            if (node.childList == undefined) {
                                alert('No samples are available for this variable!');
                            }
                        }
                    });
                },
                onSelect: function(flag, node) {
                    if (flag && node.childList == undefined) {
                        node.reloadChildren(function () {
                            node.select(false);
                            node.select(true);
                        });
                    }
                    nodesCat = node.tree.getSelectedNodes();

                    if (node.data.pType != undefined) {
                        if (node.bSelected) {
                            $("#ellipse").prop("checked", true);
                            $("#ellipseVal").val(node.data.title);
                        } else {
                            $("#ellipse").prop("checked", false);
                            $("#ellipseVal").val("");
                        }
                    }

                    $("#run").css("background-color", "lightgray");
                }
            });

            $("#tree_metaQuant").dynatree({
                checkbox: true,
                selectMode: 3,
                initAjax: {
                    url: '/getSampleQuantTree/',
                    dataType: 'jsonp',
                    data: {}
                },
                onLazyRead: function(node) {
                    node.appendAjax({
                        url: '/getSampleQuantTreeChildren/',
                        data: {pType: node.data.pType, field: node.data.title},
                        success: function(node) {
                            if (node.childList == undefined) {
                                alert('No samples are available for this variable!');
                            }
                        }
                    });
                },
                onSelect: function(flag, node) {
                    if (flag && node.childList == undefined) {
                        node.reloadChildren(function () {
                            node.select(false);
                            node.select(true);
                        });
                    }
                    nodesQuant = node.tree.getSelectedNodes();

                    if (node.data.pType != undefined) {
                        if (node.bSelected) {
                            $("#surf").prop("checked", true);
                            $("#surfVal").val(node.data.title);
                        } else {
                            $("#surf").prop("checked", false);
                            $("#surfVal").val("");
                        }
                    }

                    $("#run").css("background-color", "lightgray");
                }
            });

            var $button = $('#hide');
            $button.click(function() {
                var series = chart1.series[0];
                if (series.visible) {
                    $(chart1.series).each(function(){
                        this.setVisible(false, false);
                    });
                    chart1.redraw();
                    $button.html('Show series');
                } else {
                    $(chart1.series).each(function(){
                        this.setVisible(true, false);
                    });
                    chart1.redraw();
                    $button.html('Hide series');
                }
            });

            $('#button').click(function() {
                var index = prompt("Please enter the series index (position in legend) you wish to change:", 0);
                var color = prompt("Please enter your desired color:", "#008800");
                var marker = prompt("Please enter your desired symbol:", "square");
                var series = chart1.series[index];
                if (color != '') {
                    series.options.color = color;
                    series.options.states.hover.color = color;
                }
                if (marker != '') {
                    series.options.marker.symbol = marker;
                }
                if ((color != '') || (marker != '')) {
                    series.update(series.options);
                    chart1.redraw();
                }
                var item = series.legendItem;
                item.on('mouseover', function (e) {
                    $(this).qtip({
                        content: {
                            text: 'Index: ' + index + '<br>' + 'Color: ' + color + '<br>' + 'Symbol: ' + marker
                        },
                        style: {
                            classes: 'qtip-jtools'
                        },
                        show: {
                            ready: true
                        }
                    });
                });
            });

            $("#DepVar").change(function () {
                DepVar = $(this).val();
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#graphDisplay").change(function () {
                display = $(this).val();
                if (display == 1) {
                    $("#container-1").show();
                    $("#container-2").hide();
                    $("#highchartButtons").show();
                }
                if (display == 2) {
                    $("#container-1").hide();
                    $("#container-2").show();
                    $("#highchartButtons").hide();
                }
                $("#run").css("background-color", "lightgray");
            });

            $("#normalize").change(function () {
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#theme").change(function () {
                selTheme = $(this).val();

                if (selTheme == 1) {
                    $("#container-1").empty();
                    chart1 = new Highcharts.Chart(catOptions);
                    chart1.redraw();
                }
                else if (selTheme == 2) {
                    $.getScript('{% static 'highcharts/themes/dark-blue.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
                else if (selTheme == 3) {
                    $.getScript('{% static 'highcharts/themes/dark-green.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
                else if (selTheme == 4) {
                    $.getScript('{% static 'highcharts/themes/dark-unica.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
                else if (selTheme == 5) {
                    $.getScript('{% static 'highcharts/themes/gray.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
                else if (selTheme == 6) {
                    $.getScript('{% static 'highcharts/themes/grid.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
                else if (selTheme == 7) {
                    $.getScript('{% static 'highcharts/themes/grid-light.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
                else if (selTheme == 8) {
                    $.getScript('{% static 'highcharts/themes/sand-signika.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
                else if (selTheme == 9) {
                    $.getScript('{% static 'highcharts/themes/skies.js' %}', function () {
                        $("#container-1").empty();
                        chart1 = new Highcharts.Chart(Highcharts.merge(catOptions, theme));
                        chart1.redraw();
                    });
                }
            });

            $("#selectall").change(function () {
                taxaLevel = $(this).val();
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#distance").change(function () {
                distance = $(this).val();
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
                if (distance==15) $("#alphaLevel").show();
                else $("#alphaLevel").hide();
            });

            $("#PC1").change(function () {
                PC1 = $(this).val();
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#PC2").change(function () {
                PC2 = $(this).val();
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#NormMeth").change(function () {
                NormMeth = $(this).val();
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#NormVal").change(function () {
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#Iters").change(function () {
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });


            $("#MinVal").change(function () {
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#test").change(function () {
                test = $(this).val();
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });

            $("#alphaLevel").change(function () {
                $("#run").css("background-color", "lightgray");
            });

            $("#perms").change(function () {
                $("#run").css("background-color", "lightgray");
            });

            $("#run").click(function () {
                $("#my_image").attr("src", "#");
                $("#container-0").show();
                $("#container-1").hide();
                $("#container-2").hide();
                if(running == true) {
                    alert("myPhyloDB is currently running your previous analysis request!");
                    return false;
                }
                running = true;
                chooseData();
            });

           $("#stop").show().click(function () {
                running = false;
                stopAll();
            });

            $("#clearMeta").click(function(){
                $("#tree_metaCat").dynatree("getRoot").visit(function (node) {
                    node.select(false);
                });
                 $("#run").css("background-color", "lightgray");
            });

            $("#remove").change(function () {
                if ( document.getElementById('remove').checked ) {
                    remove = 1
                } else {
                    remove = 0
                }
                chooseDisplay();
                $("#run").css("background-color", "lightgray");
            });
        });

        function stopAll() {
            clearInterval(refresh);
            $.ajax({
                url: '/stopPCoA/',
                type: 'GET',
                dataType: 'json',
                data: {},
                success: function (data) {
                    $("#run").css("background-color", "red");
                    var result = JSON.stringify(data);
                    var obj = $.parseJSON(result);
                    var stage = obj['error'];
                    $('#container-0').empty().append(stage);
                }
            });
        }

        function updateStatus(RID) {
            $.ajax({
                url: '/statusPCoA/',
                type: 'GET',
                dataType: 'json',
                data: {
                    all: RID
                },
                success: function (data) {
                    var result = JSON.stringify(data);
                    var obj = $.parseJSON(result);
                    var stage = obj['stage'];
                    $('#container-0').empty().append(stage);
                }
            });
        }

        function startTimer(RID) {
            refresh = setInterval(function(){updateStatus(RID);}, 1000);
            return refresh;
        }

        function stopTimer() {
            clearInterval(refresh);

        }

        function chooseDisplay() {
            if (NormMeth==1) {
                $("#NormRow").hide();
                $("#NormRow-off").show();
                $("#MinRow").hide();
                $("#MinRow-off").show();
                $("#IterRow").hide();
                $("#IterRow-off").show();
            }
            if ((NormMeth == 2) || (NormMeth == 3)) {
                $("#NormRow").show();
                $("#NormRow-off").hide();
                $("#MinRow").hide();
                $("#MinRow-off").show();
                $("#IterRow").show();
                $("#IterRow-off").hide();
            }
            if ((NormMeth == 4) || (NormMeth == 5) || (NormMeth == 6)) {
                $("#NormRow").hide();
                $("#NormRow-off").show();
                $("#MinRow").show();
                $("#MinRow-off").hide();
                $("#IterRow").hide();
                $("#IterRow-off").show();
            }
        }

        function chooseData() {
            if (document.getElementById("alphaVal").value < 0 || document.getElementById("alphaVal").value > 10){
                alert("Alpha must be between 0 and 10");
                running = false;
                return;
            }

            if (nodesCat == "") {
                $("#container-1").empty().append('Please choose a categorical variable(s)!');
                $("#text-1").val('No data selected');
                $("#text-raw").val('No data selected');
                $("#run").css("background-color", "red");
                running = false;
            }
            if (nodesCat != "") {
                $("#run").css("background-color", "yellow");
                $("#container-1").empty().append('Analysis is running...please be patient');
                getGraphData();
            }
        }

        function makeGUID(){
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            })
        }

        function getGraphData() {
            var RID = makeGUID();
            startTimer(RID);
            var arrayValsCat = [];
            var arrayIDsCat = [];
            var arrayValsQuant = [];
            var arrayIDsQuant = [];
            var key = '';
            var value = '';
            var vals = '';
            var id = '';
            var ids = '';
            for (var i = 0; i < nodesQuant.length; i++) {
                if (nodesQuant[i].getLevel() == 5) {
                    if ((nodesQuant[i].data.table == 'mimark') || (nodesQuant[i].data.table == 'user')) {
                        key = nodesQuant[i].data.field;
                        value = nodesQuant[i].data.value;
                        id = nodesQuant[i].data.id;
                        vals = '"' + key + '" : "' + value + '"';
                        arrayValsQuant.push(vals);
                        ids = '"' + key + '" : "' + id + '"';
                        arrayIDsQuant.push(ids);
                    }
                }
                else if (nodesQuant[i].getLevel() == 6) {
                    if ((nodesQuant[i].data.table == 'human_associated') || (nodesQuant[i].data.table == 'soil')) {
                        key = nodesQuant[i].data.field;
                        value = nodesQuant[i].data.value;
                        id = nodesQuant[i].data.id;
                        vals = '"' + key + '" : "' + value + '"';
                        arrayValsQuant.push(vals);
                        ids = '"' + key + '" : "' + id + '"';
                        arrayIDsQuant.push(ids);
                    }
                }
            }
            for (var i = 0; i < nodesCat.length; i++) {
                if (nodesCat[i].getLevel() == 5) {
                    if ((nodesCat[i].data.table == 'mimark') || (nodesCat[i].data.table == 'user')) {
                        key = nodesCat[i].data.field;
                        value = nodesCat[i].data.value;
                        id = nodesCat[i].data.id;
                        vals = '"' + key + '" : "' + value + '"';
                        arrayValsCat.push(vals);
                        ids = '"' + key + '" : "' + id + '"';
                        arrayIDsCat.push(ids);
                    }
                }
                else if (nodesCat[i].getLevel() == 6) {
                    if ((nodesCat[i].data.table == 'human_associated') || (nodesCat[i].data.table == 'soil')) {
                        key = nodesCat[i].data.field;
                        value = nodesCat[i].data.value;
                        id = nodesCat[i].data.id;
                        vals = '"' + key + '" : "' + value + '"';
                        arrayValsCat.push(vals);
                        ids = '"' + key + '" : "' + id + '"';
                        arrayIDsCat.push(ids);
                    }
                }
            }

            var metaValsCat = '';
            if (nodesCat.length > 0) {
                metaValsCat = "{" + arrayValsCat.join(",") + "}";
            }

            var metaIDsCat = '';
            if (nodesCat.length > 0) {
                metaIDsCat = "{" + arrayIDsCat.join(",") + "}";
            }

            var metaValsQuant = '';
            if (nodesQuant.length > 0) {
                metaValsQuant = "{" + arrayValsQuant.join(",") + "}";
            }

            var metaIDsQuant = '';
            if (nodesQuant.length > 0) {
                metaIDsQuant = "{" + arrayIDsQuant.join(",") + "}";
            }

            var metaVals = '';
            if ((nodesCat.length > 0) && (nodesQuant.length > 0)) {
                metaVals = "{" + arrayValsCat.join(",") + "," + arrayValsQuant.join(",") + "}";
            }
            else if ((nodesCat.length == 0) && (nodesQuant.length > 0)) {
                metaVals = "{" + arrayValsQuant.join(",") + "}";
            }
            else if ((nodesCat.length > 0) && (nodesQuant.length == 0)) {
                metaVals = "{" + arrayValsCat.join(",") + "}";
            }

            var metaIDs = '';
            if ((nodesCat.length > 0) && (nodesQuant.length > 0)) {
                metaIDs = "{" + arrayIDsCat.join(",") + "," + arrayIDsQuant.join(",") + "}";
            }
            else if ((nodesCat.length == 0) && (nodesQuant.length > 0)) {
                metaIDs = "{" + arrayIDsQuant.join(",") + "}";
            }
            else if ((nodesCat.length > 0) && (nodesQuant.length == 0)) {
                metaIDs = "{" + arrayIDsCat.join(",") + "}";
            }

            var myDict = {};
            myDict['metaVals'] = metaVals;
            myDict['metaIDs'] = metaIDs;
            myDict['metaValsCat'] = metaValsCat;
            myDict['metaIDsCat'] = metaIDsCat;
            myDict['metaValsQuant'] = metaValsQuant;
            myDict['metaIDsQuant'] = metaIDsQuant;
            myDict['taxa'] = taxaLevel;
            myDict['DepVar'] = DepVar;
            myDict['distance'] = distance;
            myDict['PC1'] = PC1;
            myDict['PC2'] = PC2;
            myDict['NormVal'] = document.getElementById("NormVal").value;
            myDict['Iters'] = document.getElementById("Iters").value;
            myDict['remove'] = remove;
            myDict['test'] = test;
            myDict['alpha'] = document.getElementById("alphaVal").value;
            myDict['perms'] = document.getElementById("perms").value;
            myDict['NormMeth'] = NormMeth;
            myDict['MinSize'] = document.getElementById("MinVal").value;
            myDict['RID'] = RID;
            myDict['ellipseVal'] = document.getElementById("ellipseVal").value;
            myDict['surfVal'] = document.getElementById("surfVal").value;
            if ($("#ellipse").is(':checked')) {
                myDict['addEllipse'] = 'yes'
            } else {
                myDict['addEllipse'] = 'no'
            }
            if ($("#surf").is(':checked')) {
                myDict['addSurf'] = 'yes'
            } else {
                myDict['addSurf'] = 'no'
            }
            var jsonDict = JSON.stringify(myDict);

            $.ajax({
                url: '/getPCoA/',
                type: 'GET',
                dataType: 'json',
                data: {
                    all: jsonDict
                },
                success: function(data) {
                    running = false;
                    stopTimer(refresh);
                    var result = JSON.stringify(data);
                    var obj = $.parseJSON(result);
                    var xAxis = obj['xAxis'];
                    var series = obj['series'];
                    var yAxis = obj['yAxis'];
                    var error = data['error'];
                    if (error != "none") {
                        alert(error);
                        $("#run").css("background-color", "red");
                    } else {
                        $("#run").css("background-color", "green");
                    }
                    linechart1(xAxis, yAxis, series);

                    var text = obj['text'];
                    $('#text-1').val(text);

                    var res_table = obj['res_table'];
                    $('#res_table').empty().append(res_table).find('.table').DataTable({
                        dom: 'Bfrtip',
                        scroller: true,
                        scrollX: 600,
                        scrollY: 600,
                        //fixedHeader: true,
                        buttons: [ 'copy', 'csv', 'excel', 'pdf', 'print' ]
                    }).draw();

                    var dist_table = obj['dist_table'];
                    $('#dist_table').empty().append(dist_table).find('.table').DataTable({
                        dom: 'Bfrtip',
                        scroller: true,
                        scrollX: 600,
                        scrollY: 600,
                        //fixedHeader: true,
                        buttons: [ 'copy', 'csv', 'excel', 'pdf', 'print' ]
                    }).draw();

                    $("#image").show();
                    {% static "" as baseUrl %}
                    var d = new Date();
                    $("#my_image").removeAttr("src").attr("src", "{{ baseUrl }}/Rplots/{{ fileStr }}.pcoa.jpg?"+d.getTime());

                    $("#container-0").hide();
                    var display = $("#graphDisplay").val();
                    if (display == 1) {
                        $("#container-1").show();
                        $("#container-2").hide();
                    }
                    if (display == 2) {
                        $("#container-1").hide();
                        $("#container-2").show();
                    }
                }
            });
        }

        function linechart1(xAxis, yAxis, series) {
            catOptions = {
                chart: {
                    renderTo: 'container-1',
                    type: 'scatter',
                    zoomType: 'xy',
                    events: {
                        load: function () {
                            var chart = this,
                                    legend = chart.legend;
                            for (var i = 0, len=legend.allItems.length; i< len; i++) {
                                (function(i) {
                                    var item = legend.allItems[i].legendItem;
                                    var color = chart.series[i].color;
                                    var symbol = chart.series[i].symbol;
                                    item.on('mouseover', function (e) {
                                        $(this).qtip({
                                            content: {
                                                text: 'Index: ' + i + '<br>' + 'Color: ' + color + '<br>' + 'Symbol: ' + symbol
                                            },
                                            style: {
                                                classes: 'qtip-jtools'
                                            },
                                            show: {
                                                ready: true
                                            }
                                        });
                                    });
                                })(i);
                            }
                        }
                    }
                },
                title: { text: null },
                legend: {
                    itemStyle: {
                        fontSize: '7px',
                        font: '7pt Trebuchet MS, Verdana, sans-serif'
                    },
                    align: 'right',
                    verticalAlign: 'top',
                    layout: 'vertical',
                    x: 0,
                    y: 20
                },
                xAxis: xAxis,
                yAxis: yAxis,
                series: series,
                tooltip: {
                    formatter: function () {
                        return this.series.name + '<br/>' + '(' + this.x + ',' + this.y + ')'
                    }
                },
                credits: { enabled: false }
            };
            chart1 = new Highcharts.Chart(catOptions);
        }
    </script>
{% endblock javascript %}

{% block my_content %}
    <br>
    <!-- tree tables -->
    <div>
    <table border="2" cellspacing="0" cellpadding="5" class="inlineTable">
        <tr>
            <th>Select Meta Data:<a href="#" id="clearMeta" style="font-size: 12px;">-Deselect all-</a></th>
        </tr>
        <tr>
            <td style="padding-right: 10px; vertical-align: top">
                <div id="tree_metaCat"></div>
                <div id="tree_metaQuant"></div>
            </td>
        </tr>
    </table>

    <table border="0" cellspacing="0" cellpadding="5"  class="inlineTable">
        <tr>
            <th bgcolor="white"></th>
            <th bgcolor="white"></th>
            <th bgcolor="white"></th>
        </tr>
        <tr>
            <td bgcolor="white" width="5px"></td>
            <td bgcolor="white">
                <select id="selectall">
                    <option value="2">Phyla</option>
                    <option value="3">Classes</option>
                    <option value="4">Orders</option>
                    <option value="5">Families</option>
                    <option value="6">Genera</option>
                    <option value="7" selected="selected">Species</option>
                </select>
                &nbsp<-- Selected taxa level
            </td>
            <td bgcolor="white"></td>
        </tr>
        <tr>
            <td bgcolor="white" width="5px"></td>
            <td bgcolor="white">
                <select id="distance">
                    <option value="1">Manhattan</option>
                    <option value="2">Euclidean</option>
                    <option value="3">Canberra</option>
                    <option value="4">Bray-Curtis</option>
                    <option value="5">Kulczynski</option>
                    <option value="6">Jaccard</option>
                    <option value="7">Gower</option>
                    <option value="8">altGower</option>
                    <option value="9">Morisita</option>
                    <option value="10">Horn</option>
                    <option value="11">Mountford</option>
                    <option value="12">Binomial</option>
                    <option value="13">Chao</option>
                    <option value="14">Cao</option>
                    <option value="15" selected="selected">wOdum</option>
                </select>
                &nbsp<-- Selected distance score
            </td>
            <td bgcolor="white">
                <div id="alphaLevel">&#945 parameter: <input type="text" id="alphaVal" value="1" style="width:40px; background-color: white"/></div>
            </td>
        </tr>
        <tr>
            <td bgcolor="white" width="5px"></td>
            <td bgcolor="white">
                <select id="PC1">
                    <option value="1" selected="selected">PC1</option>
                    <option value="2">PC2</option>
                    <option value="3">PC3</option>
                    <option value="4">PC4</option>
                    <option value="5">PC5</option>
                    <option value="6">PC6</option>
                </select>
                &nbsp<-- Selected 1st PCoA axis (x-axis)
            </td>
            <td bgcolor="white"></td>
        </tr>
        <tr>
            <td bgcolor="white" width="5px"></td>
            <td bgcolor="white" id="PC2-text">
                <select id="PC2">
                    <option value="1">PC1</option>
                    <option value="2" selected="selected">PC2</option>
                    <option value="3">PC3</option>
                    <option value="4">PC4</option>
                    <option value="5">PC5</option>
                    <option value="6">PC6</option>
                </select>
                &nbsp<-- Selected 2nd PCoA axis (y-axis)
            </td>
            <td bgcolor="white"></td>
        </tr>
        <tr>
            <td bgcolor="white" width="5px"></td>
            <td bgcolor="white" id="test-text">
                <select id="test">
                    <option value=1 selected="selected">perMANOVA</option>
                    <option value=2>betaDisper</option>
                </select>
                &nbsp<-- Selected test
            </td>
            <td bgcolor="white">
                <div style="background-color: white" id="permutations">permutations: <input type="text" id="perms" value="1000" style="width:40px; background-color: white"/></div>
            </td>
        </tr>
        <tr>
            <td bgcolor="white"></td>
            <td bgcolor="white"></td>
            <td bgcolor="white"></td>
        </tr>
        <tr>
            <td bgcolor="white"></td>
            <td bgcolor="white">Optimize R plot:</td>
            <td bgcolor="white"></td>
        </tr>
        <tr>
            <td bgcolor="white"></td>
            <td bgcolor="white">
                <div style="background-color: white">
                    Add ordiellipse: <input type="checkbox" title="Click to turn ordiellipse on/off" id="ellipse"/>
                    <input type="text" title="Input box is automatically changed to the last variable you selected. <br> If checked, an entry is required. <br> To change, manually type in your desired variable." id="ellipseVal" value="" style="background-color: white"/>
                </div>
            </td>
            <td bgcolor="white"></td>
        </tr>
        <tr>
            <td bgcolor="white"></td>
            <td bgcolor="white">
                <div style="background-color: white">
                    Add ordisurf: <input type="checkbox"  title="Click to turn ordisurf on/off" id="surf"/>
                    <input type="text"  title="Input box is automatically changed to the last variable you selected. <br> No entry is required. <br> To change, manually type in your desired variable." id="surfVal" value="" style="background-color: white"/>
                </div>
            </td>
            <td bgcolor="white"></td>
        </tr>
    </table>
    </div>
    <br>

    <div id="stage"></div>
    <br><br>

    <table width="950px" border="2">
        <tr>
            <th colspan="3" style="padding-right: 10px;">GraphData</th>
        </tr>
        <tr>
            <td style="width: 36%; text-align: left">
                Dependent variable:<select id="DepVar">
                <option value="1">Relative Abundance (counts)</option>
                <option value="4">Total Abundance</option>
                <option value="2">Species Richness</option>
                <option value="3">Species Diversity</option>
                </select>
            </td>
            <td style="width: 34%; text-align: center">
                Normalization method:
                <select id="NormMeth">
                    <option value="1">None</option>
                    <option value="2">Rarefaction (remove)</option>
                    <option value="3" selected="selected">Rarefaction (keep)</option>
                    <!--<option value="4">Proportion</option>-->
                    <option value="5">DESeq2</option>
                    <option value="6">DESeq2+VS</option>
                </select>
            </td>
            <td style="width: 30%; text-align: left">
                Display graph:
                <select id="graphDisplay">
                    <option value="1">Highcharts</option>
                    <option value="2">R plot</option>
                </select>
            </td>
        </tr>
        <tr>
            <td></td>
            <td id="MinRow" style="display: none; text-align: center">
                Minimum sample size:
                <input type="text" id="MinVal" value="1000"/>
            </td>
            <td id="NormRow-off" style="display: none;"></td>
            <td id="NormRow" style="text-align: center;">
                Subsample size:
                <input type="text" id="NormVal" value="median"/>
            </td>
            <td id="MinRow-off"></td>
        </tr>
        <tr>
            <td></td>
            <td id="IterRow-off" style="display: none;"></td>
            <td id="IterRow" style="text-align: center">
                Iterations:
                <input style="background-color: white" type="text" id="Iters" value="1"/>
            </td>
            <td></td>
        </tr>
        <tr>
            <td colspan="3">
                <div id="container-0" style="height: 400px; width:950px;">No Data has been selected!</div>
                <div id="container-1" style="height: 400px; width:950px; display:none"></div>
                <div id="container-2" style="height: 405px; width:950px; display:none; overflow-x: auto; overflox-y: auto;"><span id="image" style="display:none;"><img id="my_image" src="#" /></span></div>
            </td>
        </tr>
        <tr id="highchartButtons">
            <td>
                <button id="hide" title="Click to show/hide all series in the graph">Hide all series</button>
            </td>
            <td>Select chart theme:
                <select id="theme">
                    <option value="1" selected="selected">default</option>
                    <option value="2">dark-blue</option>
                    <option value="3">dark-green</option>
                    <option value="4">dark-unica</option>
                    <option value="5">gray</option>
                    <option value="6">grid</option>
                    <option value="7">grid-light</option>
                    <option value="8">sand-signika</option>
                    <option value="9">skies</option>
                </select>
                &nbsp&nbsp
            </td>
            <td>
                <button id="button" title="Click to change an individual series color or symbol" style="float: right">Change series</button>
            </td>
        </tr>
    </table>

    <div id="txt-1">
        <h2>Test Results:</h2>
        <textarea style="width: 950px;" wrap="off" id="text-1" rows="20">No data selected</textarea>
        <br>
    </div>
    <br>

    <h2>Principal Coordinates:</h2>
    <div id="res_table" style="width: 950px; overflow-x: auto;"></div>
    <br>

    <h2>Distance Scores:</h2>
    <div id="dist_table" style="width: 950px; overflow-x: auto;"></div>
    <br>
    <br>
    <br>
{% endblock my_content%}
